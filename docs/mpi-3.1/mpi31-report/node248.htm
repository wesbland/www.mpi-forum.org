<!DOCTYPE html>
<html lang=en>
<head>
<!-- This file was generated by tohtml from chap-dynamic/dynamic-2.tex -->
<!-- with the command
tohtml -default -basedef mpi3defs.txt -numbers -indexname myindex -dosnl -htables -quietlatex -allgif -endpage mpi3-forum-tail.htm -Wnoredef -o mpi31-report.tex mpi-report.tex 
-->
<title>Client/Server Examples</title>
</head>
<body style="background-color:#FFFFFF">
<hr><h2><span id="Node248">230. Client/Server Examples</span></h2>
<a href="node247.htm#Node247"><img width=16 height=16 src="previous.gif" alt="Previous"></a><a href="node242.htm#Node242"><img width=16 height=16 src="up.gif" alt="Up"></a><a href="node248.htm#Node249"><img width=16 height=16 src="next.gif" alt="Next"></a><br>
<b>Up: </b><a href="node242.htm#Node242"> Establishing Communication</a>
<b>Next: </b><a href="node248.htm#Node249"> Simplest Example --- Completely Portable.</a>
<b>Previous: </b><a href="node247.htm#Node247"> Reserved Key Values</a>
<p>
  
<P> 
<ul> 
</ul> 

<P>
<hr>
<a href="node247.htm#Node247"><img width=16 height=16 src="previous.gif" alt="Previous"></a><a href="node242.htm#Node242"><img width=16 height=16 src="up.gif" alt="Up"></a><a href="node248.htm#Node249"><img width=16 height=16 src="next.gif" alt="Next"></a><br>
<b>Up: </b><a href="node242.htm#Node242"> Establishing Communication</a>
<b>Next: </b><a href="node248.htm#Node249"> Simplest Example --- Completely Portable.</a>
<b>Previous: </b><a href="node247.htm#Node247"> Reserved Key Values</a>
<p>
<hr><h3><span id="Node249">230.1. Simplest Example --- Completely Portable.</span></h3>
<a href="node248.htm#Node248"><img width=16 height=16 src="previous.gif" alt="Previous"></a><a href="node248.htm#Node248"><img width=16 height=16 src="up.gif" alt="Up"></a><a href="node248.htm#Node250"><img width=16 height=16 src="next.gif" alt="Next"></a><br>
<b>Up: </b><a href="node248.htm#Node248"> Client/Server Examples</a>
<b>Next: </b><a href="node248.htm#Node250"> Ocean/Atmosphere --- Relies on Name Publishing</a>
<b>Previous: </b><a href="node248.htm#Node248"> Client/Server Examples</a>
<p>
The following example shows the simplest way to use  
the client/server interface. It does not use service  
names at all.   
<P> 
On the server side:  
<br> 
<pre><tt>    char myport[MPI_MAX_PORT_NAME]; 
    MPI_Comm intercomm; 
    /* ... */ 
    MPI_Open_port(MPI_INFO_NULL, myport); 
    printf("port name is: %s\n", myport); 
 
    MPI_Comm_accept(myport, MPI_INFO_NULL, 0, MPI_COMM_SELF, &amp;intercomm); 
    /* do something with intercomm */ 
</tt></pre> 
The server prints out the port name to the terminal and the user  
must type it in when starting up the client (assuming the <font face="sans-serif"> MPI</font>  
implementation supports <font face="sans-serif"> stdin</font> such that this works).   
On the client side:  
<br> 
<pre><tt>    MPI_Comm intercomm; 
    char name[MPI_MAX_PORT_NAME]; 
    printf("enter port name: ");  
    gets(name); 
    MPI_Comm_connect(name, MPI_INFO_NULL, 0, MPI_COMM_SELF, &amp;intercomm); 
</tt></pre> 

<P>
<hr>
<a href="node248.htm#Node248"><img width=16 height=16 src="previous.gif" alt="Previous"></a><a href="node248.htm#Node248"><img width=16 height=16 src="up.gif" alt="Up"></a><a href="node248.htm#Node250"><img width=16 height=16 src="next.gif" alt="Next"></a><br>
<b>Up: </b><a href="node248.htm#Node248"> Client/Server Examples</a>
<b>Next: </b><a href="node248.htm#Node250"> Ocean/Atmosphere --- Relies on Name Publishing</a>
<b>Previous: </b><a href="node248.htm#Node248"> Client/Server Examples</a>
<p>
<hr><h3><span id="Node250">230.2. Ocean/Atmosphere --- Relies on Name Publishing</span></h3>
<a href="node248.htm#Node249"><img width=16 height=16 src="previous.gif" alt="Previous"></a><a href="node248.htm#Node248"><img width=16 height=16 src="up.gif" alt="Up"></a><a href="node248.htm#Node251"><img width=16 height=16 src="next.gif" alt="Next"></a><br>
<b>Up: </b><a href="node248.htm#Node248"> Client/Server Examples</a>
<b>Next: </b><a href="node248.htm#Node251"> Simple Client-Server Example</a>
<b>Previous: </b><a href="node248.htm#Node249"> Simplest Example --- Completely Portable.</a>
<p>
In this example, the ``ocean'' application is the ``server''  
side of a coupled ocean-atmosphere climate model. It assumes  
that the <font face="sans-serif"> MPI</font> implementation publishes names.   
<P> 
<br> 
<pre><tt>    MPI_Open_port(MPI_INFO_NULL, port_name); 
    MPI_Publish_name("ocean", MPI_INFO_NULL, port_name); 
 
    MPI_Comm_accept(port_name, MPI_INFO_NULL, 0, MPI_COMM_SELF, &amp;intercomm); 
    /* do something with intercomm */ 
    MPI_Unpublish_name("ocean", MPI_INFO_NULL, port_name); 
 
</tt></pre> 
On the client side:  
<br> 
<pre><tt>    MPI_Lookup_name("ocean", MPI_INFO_NULL, port_name); 
    MPI_Comm_connect(port_name, MPI_INFO_NULL, 0, MPI_COMM_SELF,  
                      &amp;intercomm); 
</tt></pre> 

<P>
<hr>
<a href="node248.htm#Node249"><img width=16 height=16 src="previous.gif" alt="Previous"></a><a href="node248.htm#Node248"><img width=16 height=16 src="up.gif" alt="Up"></a><a href="node248.htm#Node251"><img width=16 height=16 src="next.gif" alt="Next"></a><br>
<b>Up: </b><a href="node248.htm#Node248"> Client/Server Examples</a>
<b>Next: </b><a href="node248.htm#Node251"> Simple Client-Server Example</a>
<b>Previous: </b><a href="node248.htm#Node249"> Simplest Example --- Completely Portable.</a>
<p>
<hr><h3><span id="Node251">230.3. Simple Client-Server Example</span></h3>
<a href="node248.htm#Node250"><img width=16 height=16 src="previous.gif" alt="Previous"></a><a href="node248.htm#Node248"><img width=16 height=16 src="up.gif" alt="Up"></a><a href="node252.htm#Node252"><img width=16 height=16 src="next.gif" alt="Next"></a><br>
<b>Up: </b><a href="node248.htm#Node248"> Client/Server Examples</a>
<b>Next: </b><a href="node252.htm#Node252"> Other Functionality</a>
<b>Previous: </b><a href="node248.htm#Node250"> Ocean/Atmosphere --- Relies on Name Publishing</a>
<p>
This is a simple example; the server  
accepts only a single connection at a time and serves that connection until  
the client requests to be disconnected.  The server is a single  
process.   
<P> 
Here is the server.  It accepts a single connection and then processes data  
until it receives a message with tag <tt>1</tt>.  A message with tag <tt>0</tt>  
tells the server to exit.  
<br> 
<pre><tt>#include "mpi.h" 
int main(int argc, char *argv[]) 
{ 
    MPI_Comm client; 
    MPI_Status status; 
    char port_name[MPI_MAX_PORT_NAME]; 
    double buf[MAX_DATA]; 
    int    size, again; 
 
    MPI_Init(&amp;argc, &amp;argv); 
    MPI_Comm_size(MPI_COMM_WORLD, &amp;size); 
    if (size != 1) error(FATAL, "Server too big"); 
    MPI_Open_port(MPI_INFO_NULL, port_name); 
    printf("server available at %s\n", port_name); 
    while (1) { 
        MPI_Comm_accept(port_name, MPI_INFO_NULL, 0, MPI_COMM_WORLD,  
                         &amp;client); 
        again = 1; 
        while (again) { 
            MPI_Recv(buf, MAX_DATA, MPI_DOUBLE,  
                      MPI_ANY_SOURCE, MPI_ANY_TAG, client, &amp;status); 
            switch (status.MPI_TAG) { 
                case 0: MPI_Comm_free(&amp;client); 
                        MPI_Close_port(port_name); 
                        MPI_Finalize(); 
                        return 0; 
                case 1: MPI_Comm_disconnect(&amp;client); 
                        again = 0; 
                        break; 
                case 2: /* do something */ 
                ... 
                default: 
                        /* Unexpected message type */ 
                        MPI_Abort(MPI_COMM_WORLD, 1); 
                } 
            } 
        } 
} 
</tt></pre> 
Here is the client.  
<P> 
<br> 
<pre><tt>#include "mpi.h" 
int main( int argc, char **argv ) 
{ 
    MPI_Comm server; 
    double buf[MAX_DATA]; 
    char port_name[MPI_MAX_PORT_NAME]; 
 
    MPI_Init( &amp;argc, &amp;argv ); 
    strcpy( port_name, argv[1] );/* assume server's name is cmd-line arg */ 
 
    MPI_Comm_connect( port_name, MPI_INFO_NULL, 0, MPI_COMM_WORLD,  
                      &amp;server ); 
 
    while (!done) { 
        tag = 2; /* Action to perform */ 
        MPI_Send( buf, n, MPI_DOUBLE, 0, tag, server ); 
        /* etc */ 
        } 
    MPI_Send( buf, 0, MPI_DOUBLE, 0, 1, server ); 
    MPI_Comm_disconnect( &amp;server ); 
    MPI_Finalize(); 
    return 0; 
} 
</tt></pre> 

<P>
<hr>
<a href="node248.htm#Node250"><img width=16 height=16 src="previous.gif" alt="Previous"></a><a href="node248.htm#Node248"><img width=16 height=16 src="up.gif" alt="Up"></a><a href="node252.htm#Node252"><img width=16 height=16 src="next.gif" alt="Next"></a><br>
<b>Up: </b><a href="node248.htm#Node248"> Client/Server Examples</a>
<b>Next: </b><a href="node252.htm#Node252"> Other Functionality</a>
<b>Previous: </b><a href="node248.htm#Node250"> Ocean/Atmosphere --- Relies on Name Publishing</a>
<p>
<HR>
Return to <A HREF="node523.htm">MPI-3.1 Standard Index</A><BR>
Return to <A HREF="http://www.mpi-forum.org/index.html">MPI Forum Home Page</A><BR>
<HR>
<FONT SIZE=-1>(Unofficial) MPI-3.1 of June 4, 2015<BR>
HTML Generated on June 4, 2015
</FONT>
</body>
</html>
