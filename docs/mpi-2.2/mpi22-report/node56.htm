<HTML>
<HEAD>
<!-- This file was generated by tohtml from chap-pt2pt/pt2pt.tex -->
<!-- with the command
tohtml erif"> MPI-2.0</font>
-->
<TITLE>Model Implementation of Buffered Mode</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF">
<HR><H2><A NAME="Node56">55. Model Implementation of Buffered Mode</a></H2>
<A HREF="node55.htm#Node55"><IMG WIDTH=16 HEIGHT=16 SRC="previous.gif"></A><A HREF="node55.htm#Node55"><IMG WIDTH=16 HEIGHT=16 SRC="up.gif"></A><A HREF="node57.htm#Node57"><IMG WIDTH=16 HEIGHT=16 SRC="next.gif"></A><BR>
<b>Up: </b><A HREF="node55.htm#Node55"> Buffer Allocation and Usage</a>
<b>Next: </b><A HREF="node57.htm#Node57"> Nonblocking Communication</a>
<b>Previous: </b><A HREF="node55.htm#Node55"> Buffer Allocation and Usage</a>
<P>
  
<P> 
The model implementation uses the packing and unpacking functions described in  
Section <a href="node84.htm#Node84">Pack and Unpack 
</a> and the nonblocking communication functions  
described in Section <a href="node57.htm#Node57">Nonblocking Communication 
</a>.  
<P> 
We assume that a circular queue  
of pending message entries (PME) is maintained.  Each  
entry contains a communication request handle  
that identifies a pending nonblocking  
send, a pointer to the next entry and the packed message data.  The  
entries are stored in successive locations in the buffer.  Free space is  
available between the queue tail and the queue head.  
<P> 
A buffered send call results in the execution of the following code.  
<ul> 
 
<li>Traverse sequentially the PME queue from head towards the tail,  
deleting all entries for  
communications that have completed, up to the first entry with an uncompleted  
request; update queue head to point to that entry.  
 
<li>Compute the number, <font face="sans-serif"> n</font>, of bytes needed to store an entry for the new message.  
  
An upper bound on <font face="sans-serif"> n</font> can be computed  
as follows: A call to the function <BR>  
<font face="sans-serif"> MPI_PACK_SIZE(count, datatype,  
comm, size)</font>, with the <tt> count</tt>, <tt> datatype</tt> and <tt> comm</tt> arguments  
used in the  
<font face="sans-serif"> MPI_BSEND</font> call, returns an upper bound on the amount of  
space needed to buffer the message data (see Section <a href="node84.htm#Node84">Pack and Unpack 
</a>).  
The <font face="sans-serif"> MPI</font> constant  
<font face="sans-serif">  MPI_BSEND_OVERHEAD</font> provides an upper bound on the  
additional space consumed by the entry (e.g., for pointers or envelope  
information).  
  
 
<li>Find the next contiguous empty space of <font face="sans-serif"> n</font> bytes in  
buffer (space following queue tail, or space at start of buffer if  
queue tail is  
too close to end of buffer).  If space is not found then raise buffer  
overflow error.  
 
<li>Append to end of PME queue in contiguous space the new entry  
that contains request  
handle, next pointer and packed message data; <font face="sans-serif"> MPI_PACK</font> is used to  
pack data.  
 
<li>Post nonblocking send (standard mode) for packed data.  
 
<li>Return  
</ul> 
<BR> 

<P>
<HR>
<A HREF="node55.htm#Node55"><IMG WIDTH=16 HEIGHT=16 SRC="previous.gif"></A><A HREF="node55.htm#Node55"><IMG WIDTH=16 HEIGHT=16 SRC="up.gif"></A><A HREF="node57.htm#Node57"><IMG WIDTH=16 HEIGHT=16 SRC="next.gif"></A><BR>
<b>Up: </b><A HREF="node55.htm#Node55"> Buffer Allocation and Usage</a>
<b>Next: </b><A HREF="node57.htm#Node57"> Nonblocking Communication</a>
<b>Previous: </b><A HREF="node55.htm#Node55"> Buffer Allocation and Usage</a>
<P>
<HR>
Return to <A HREF="node434.htm">MPI-2.2 Standard Index</A><BR>
Return to <A HREF="http://www.mpi-forum.org/index.html">MPI Forum Home Page</A><BR>
<HR>
<FONT SIZE=-1>(Unofficial) MPI-2.2 of September 4, 2009<BR>
HTML Generated on September 10, 2009
</FONT>
</BODY>
</HTML>
