<HTML>
<!-- This file was generated by tohtml from prof.tex -->
<TITLE>MPI library implementation</TITLE>
<BODY BGCOLOR="#FFFFFF">
<HR><H2><A NAME="Node159">8.4.2. MPI library implementation</a></H2>
<A HREF="node158.html#Node158"><IMG SRC="previous.gif"></A><A HREF="node157.html#Node157"><IMG SRC="up.gif"></A><A HREF="node159.html#Node160"><IMG SRC="next.gif"></A><BR>
<b>Up: </b><A HREF="node157.html#Node157"> Examples</a>
<b>Next: </b><A HREF="node159.html#Node160"> Systems with weak symbols</a>
<b>Previous: </b><A HREF="node158.html#Node158"> Profiler implementation</a>
<P>
On a Unix system, in which the  MPI library is implemented in C, then  
there are various possible options, of which two of the most obvious  
are presented here. Which is better depends on whether the linker and  
compiler support weak symbols.  
<P> 
<menu> 
</menu> 

<P>
<HR>
<A HREF="node158.html#Node158"><IMG SRC="previous.gif"></A><A HREF="node157.html#Node157"><IMG SRC="up.gif"></A><A HREF="node159.html#Node160"><IMG SRC="next.gif"></A><BR>
<b>Up: </b><A HREF="node157.html#Node157"> Examples</a>
<b>Next: </b><A HREF="node159.html#Node160"> Systems with weak symbols</a>
<b>Previous: </b><A HREF="node158.html#Node158"> Profiler implementation</a>
<P>
<HR><H3><A NAME="Node160">8.4.2.1. Systems with weak symbols</a></H3>
<A HREF="node159.html#Node159"><IMG SRC="previous.gif"></A><A HREF="node159.html#Node159"><IMG SRC="up.gif"></A><A HREF="node159.html#Node161"><IMG SRC="next.gif"></A><BR>
<b>Up: </b><A HREF="node159.html#Node159"> MPI library implementation</a>
<b>Next: </b><A HREF="node159.html#Node161"> Systems without weak symbols</a>
<b>Previous: </b><A HREF="node159.html#Node159"> MPI library implementation</a>
<P>
If the compiler and linker support weak external symbols (e.g. Solaris  
2.x, other system V.4 machines), then only a single library is  
required through the use of <tt> #pragma weak</tt> thus   
<P> 
<BR> 
<pre><tt>#pragma weak MPI_Example = PMPI_Example 
<P> 
int PMPI_Example(/* appropriate args */) 
{ 
    /* Useful content */         
} 
</tt></pre> 
The effect of this <tt> #pragma</tt> is to define the external symbol <tt>  
MPI_Example</tt> as a weak definition. This means that the linker will  
not complain if there is another definition of the symbol (for  
instance in the profiling library), however if no other definition  
exists, then the linker will use the weak definition.   
<P> 

<P>
<HR>
<A HREF="node159.html#Node159"><IMG SRC="previous.gif"></A><A HREF="node159.html#Node159"><IMG SRC="up.gif"></A><A HREF="node159.html#Node161"><IMG SRC="next.gif"></A><BR>
<b>Up: </b><A HREF="node159.html#Node159"> MPI library implementation</a>
<b>Next: </b><A HREF="node159.html#Node161"> Systems without weak symbols</a>
<b>Previous: </b><A HREF="node159.html#Node159"> MPI library implementation</a>
<P>
<HR><H3><A NAME="Node161">8.4.2.2. Systems without weak symbols</a></H3>
<A HREF="node159.html#Node160"><IMG SRC="previous.gif"></A><A HREF="node159.html#Node159"><IMG SRC="up.gif"></A><A HREF="node162.html#Node162"><IMG SRC="next.gif"></A><BR>
<b>Up: </b><A HREF="node159.html#Node159"> MPI library implementation</a>
<b>Next: </b><A HREF="node162.html#Node162"> Complications</a>
<b>Previous: </b><A HREF="node159.html#Node160"> Systems with weak symbols</a>
<P>
In the absence of weak symbols then one possible solution would be to  
use the C macro pre-processor thus   
<P> 
<BR> 
<pre><tt>#ifdef PROFILELIB 
#    ifdef __STDC__ 
#        define FUNCTION(name) P##name 
#    else 
#        define FUNCTION(name) P/**/name 
#    endif 
#else 
#    define FUNCTION(name) name 
#endif 
</tt></pre> 
Each of the user visible functions in the library would then be  
declared thus  
<P> 
<BR> 
<pre><tt>int FUNCTION(MPI_Example)(/* appropriate args */) 
{ 
    /* Useful content */         
} 
</tt></pre> 
The same source file can then be compiled to produce both versions of  
the library, depending on the state of the <tt> PROFILELIB</tt> macro  
symbol.  
<P> 
It is required that the standard  MPI library be built in such a way  
that the inclusion of  MPI functions can be achieved one at a time.  
This is a somewhat unpleasant requirement, since it may mean that  
each external function has to be compiled from a separate file.  
However this is necessary so that the author of the profiling library  
need only define those  MPI functions which she wishes to intercept,  
references to any others being fulfilled by the normal  MPI library.  
Therefore the link step can look something like this   
<P> 
<BR> 
<pre><tt>% cc ... -lmyprof -lpmpi -lmpi 
</tt></pre> 
Here <tt> libmyprof.a</tt> contains the profiler functions which intercept  
some of the  MPI functions. <tt> libpmpi.a</tt> contains the ``name  
shifted''  MPI functions, and <tt> libmpi.a</tt> contains the normal  
definitions of the  MPI functions.   
<P> 

<P>
<HR>
<A HREF="node159.html#Node160"><IMG SRC="previous.gif"></A><A HREF="node159.html#Node159"><IMG SRC="up.gif"></A><A HREF="node162.html#Node162"><IMG SRC="next.gif"></A><BR>
<b>Up: </b><A HREF="node159.html#Node159"> MPI library implementation</a>
<b>Next: </b><A HREF="node162.html#Node162"> Complications</a>
<b>Previous: </b><A HREF="node159.html#Node160"> Systems with weak symbols</a>
<P>
<HR>
Return to <A HREF="node182.html">MPI 1.1 Standard Index</A><BR>
Return to <A HREF="http://www.mpi-forum.org/docs/mpi-20-html/node306.html">MPI-2 Standard Index</A><BR>
Return to <A HREF="http://www.mpi-forum.org/index.html">MPI Forum Home Page</A><BR>
<HR>
<FONT SIZE=-1>MPI-1.1 of June 12, 1995<BR>
HTML Generated on August 6, 1997
</FONT>
</BODY>
</HTML>
